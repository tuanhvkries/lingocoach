<div class="exercises-container">
  <!-- Exercise header -->
  <div class="exercises-header mb-4">
    <h2 class="mb-2"><%= @exercise.name %></h2>
    <p class="text-muted"><%= @exercise.language.upcase %></p>
    <%= simple_format(@exercise.content) %>
  </div>

  <hr class="my-4">

  <!-- Chats header -->
  <div class="chats-header d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <h3 class="mb-0">Chats</h3>

    <%= button_to "New chat",
          exercise_chats_path(@exercise),
          method: :post,
          class: "btn btn-outline-primary btn-sm",
          form: { data: { turbo_stream: true } } %>
  </div>

  <!-- Chats list -->
  <% if @chats.any? %>
    <div class="chats-section">
      <div class="accordion w-100" id="chatsAccordion">
        <div id="chats_list">
          <% @chats.each do |chat| %>
            <div class="accordion-item chat-item" id="chat_item_<%= chat.id %>">
              <h2 class="accordion-header" id="heading_<%= chat.id %>">
                <button
                  class="accordion-button collapsed chat-toggle"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#chat_<%= chat.id %>"
                  aria-expanded="false"
                  aria-controls="chat_<%= chat.id %>"
                >
                  <%= chat.title %>
                </button>
              </h2>

              <div
                id="chat_<%= chat.id %>"
                class="accordion-collapse collapse"
                aria-labelledby="heading_<%= chat.id %>"
                data-bs-parent="#chatsAccordion"
              >
                <div class="accordion-body chat-accordion-body">
                  <turbo-frame
                    id="chat_frame_<%= chat.id %>"
                    src="<%= chat_path(chat) %>"
                    loading="lazy"
                  >
                    <div class="text-muted small">Loading chatâ€¦</div>
                  </turbo-frame>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% else %>
    <div class="chats-section">
      <div class="accordion w-100" id="chatsAccordion">
        <div id="chats_list"></div>
      </div>
      <p class="text-muted mt-2" id="no_chats_message">There are no chats yet.</p>
    </div>
  <% end %>
</div>
